defaultNamespace: loki
# Custom helm options
helm:
  releaseName: loki
  chart: loki
  repo: https://grafana.github.io/helm-charts
  version: 3.5.0
  values:
    minio:
      enabled: true
    monitoring:
      selfMonitoring:
        enabled: false
        # Bug in the chart
        lokiCanary:
          enabled: false

dependsOn:
  - name: dgiebert-fleet-rancher-monitoring-app

# Patches needed for Fleet
diff:
  comparePatches:
  - apiVersion: apps/v1
    kind: StatefulSet
    name: loki-read
    namespace: loki
    operations:
    - {"op": "remove", "path":"/spec/persistentVolumeClaimRetentionPolicy"}

targetCustomizations:
- name: init
  helm:
    values:
      write:
        replicas: 1
      read:
        replicas: 1
      query_scheduler:
        replicas: 1
  clusterSelector:
    matchLabels:
      environment: staging